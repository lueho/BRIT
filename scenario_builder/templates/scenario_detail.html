{% extends 'base.html' %}

{% block content %}
    <div class="row">
        <div class="col col-6">
            <div class="card shadow">
                <div class="card-header"><b>Scenario basics</b></div>
                <div class="card-body p-0">
                    <table class="table">
                        <tr>
                            <td class="col-3"><b>Name:</b></td>
                            <td>{{ object.name }}</td>
                        <tr>
                            <td class="col-3"><b>Description:</b></td>
                            <td>{{ object.description }}</td>
                        <tr>
                            <td class="col-3"><b>Case study region:</b></td>
                            <td>
                                <a href="{% url 'catchment_list' %}">
                                    {{ object.region }}
                                </a>
                            </td>
                        <tr>
                            <td class="col-3"><b>Catchment:</b></td>
                            <td>
                                <a href="{% url 'catchment_list' %}">
                                    {{ object.catchment }}
                                </a>
                            </td>
                    </table>
                </div>
                <div class="card-footer">
                    <a href="javascript:void(0);" class="modal-link" ,
                       data-link="{% url 'scenario_update' scenario.id %}">
                        <i class="fas fa-fw fa-edit"></i> Edit scenario definition
                    </a>
                </div>
            </div>

        </div>
        <div class="col col-3">
            {# status = CHANGED #}
            {% if object.status == 1 %}
                <p>This is a summary of the complete configuration of this scenario. Please check if everything is as it
                    should be. Once you are sure, everything is correct you can run the scenario evaluation from
                    here.</p>
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" name="run" class="btn btn-primary">Run scenario evaluation</button>
                </form>
                {# status = RUNNING #}
            {% elif object.status == 2 %}
                <p>The scenario evaluation is currently running.</p>
                <a class="btn btn-primary" href="{% url 'scenario_result' object.id %}">View evaluation progress</a>
                {# status = FINISHED #}
            {% elif object.status == 3 %}
                <p>This is a summary of the complete configuration of this scenario. The scenario has already been
                    evaluated.</p>
                <a class="btn btn-primary" href="{% url 'scenario_result' object.id %}">View results</a>
            {% endif %}
        </div>
    </div>
    <!-- end of general summary row -->

    <div class="row mt-2">
        <div class="col">
            <div class="card shadow">
                <div class="card-header"><b>Inventory definition</b></div>
                <div class="card-body">
                    {% for feedstock, algos in config.items %}
                        {% for algo, parameters in algos.items %}
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="card border-left-primary border">
                                        <div class="card-header">
                                            <h6 class="m-0 font-weight-bold text-primary">{{ feedstock.name }}: {{ algo.name }}</h6>
                                        </div>
                                        <div class="card-body">
                                            {% for parameter, value in parameters.items %}
                                                {{ parameter.descriptive_name }}: {{ value.value }}+-
                                                {{ value.standard_deviation }}
                                                {{ parameter.unit }} source: ({{ value.source }})
                                            {% endfor %}
                                        </div>
                                        <div class="card-footer">
                                            <a href="{% url 'scenario_update_config' scenario.id algo.id %}"
                                               class="mx-2">
                                                <i class="fas fa-fw fa-edit"></i> Edit
                                            </a>
                                            <a href="{% url 'remove_algorithm_from_scenario' scenario.id feedstock.id algo.id %}"
                                               class="mx-2">
                                                <i class="fas fa-fw fa-trash"></i> Remove from configuration
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endfor %}
                    <div class="card border-left-primary border">
                        <div class="card-header">
                        </div>
                        <div class="card-body">
                            <a href="{% url 'add_scenario_configuration' scenario.id %}">
                                <i class="fas fa-fw fa-plus"></i> Add inventory
                            </a>
                        </div>
                        <div class="card-footer">
                        </div>
                    </div>
                </div>
                <div class="card-footer"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{ block.super }}

    <script type="text/javascript">
        $(document).ready(function () {

            $(".modal-link").each(function () {
                $(this).modalForm({
                    formURL: $(this).data()["link"],
                    errorClass: ".is-invalid"
                })
            });

        });
    </script>

{% endblock javascript %}
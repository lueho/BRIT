{% extends "waste_atlas/choropleth_map.html" %}

{% block atlas_config %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    WasteAtlasChoropleth.init({
      svgId:       'atlas-svg',
      containerId: 'map-container',
      loadingId:   'loading-overlay',
      country:     '{{ country }}',
      year:        parseInt('{{ year }}', 10) || 2024,
      title:       'Sammelhäufigkeit der Bioabfallabholungen',
      dataUrl:     '/waste_collection/api/waste-atlas/biowaste-collection-count/',
      dataField:   '_classified',
      categories: [
        { value: 'weekly',          label: 'Wöchentlich',                color: '#1E90FF' },
        { value: 'biweekly',        label: 'Alle zwei Wochen',           color: '#66CDAA' },
        { value: 'less_frequent',   label: 'Seltener',                   color: '#4b2a60' },
        { value: 'seasonal',        label: 'Saisonal wechselnd',         color: '#F4A460' },
        { value: 'no_door_to_door', label: 'Keine Tür-zu-Tür-Sammlung',  color: '#FFF696' }
      ],
      noDataColor: '#e0e0e0',
      noDataLabel: 'Keine Daten',
      legendTitle: 'Sammelhäufigkeit',
      fileBase:    'karte12_haeufigkeit_bioabfall',
      transformData: function (records) {
        return records.map(function (r) {
          var cls;
          if (r.collection_count === null) {
            cls = 'no_door_to_door';
          } else if (r.has_seasonal_variation) {
            cls = 'seasonal';
          } else if (r.collection_count >= 50) {
            cls = 'weekly';
          } else if (r.collection_count >= 24) {
            cls = 'biweekly';
          } else {
            cls = 'less_frequent';
          }
          return { catchment_id: r.catchment_id, _classified: cls };
        });
      }
    });
  });
</script>
{% endblock atlas_config %}

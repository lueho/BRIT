"use strict";const fieldConfig={catchment:{include:!0,format:t=>t||""},collector:{include:!0,format:t=>t||""},collection_system:{include:!0,format:t=>t||""},waste_category:{include:!0,format:t=>t||""},allowed_materials:{include:!0,format:t=>formatList(t,", ")},forbidden_materials:{include:!0,format:t=>formatList(t,", ")},fee_system:{include:!0,format:t=>t||""},population:{include:!1,format:t=>t?t.toLocaleString():""},population_density:{include:!1,format:t=>t?t.toFixed(2):""},comments:{include:!1,format:t=>formatList(t,"; ")},valid_from:{include:!1,format:t=>t?new Date(t).toLocaleDateString():""},lastmodified_at:{include:!1,format:t=>t?new Date(t).toLocaleDateString():""},sources:{include:!0,format:t=>{const e=formatUrls(t);return e?`<ul class="list-disc pl-4">${e}</ul>`:""}}};function britEnableBtn(t){t&&(t.classList.remove("disabled"),t.removeAttribute("aria-disabled"),t.removeAttribute("tabindex"),t.title&&-1!==t.title.indexOf("Select a collection")&&t.removeAttribute("title"))}function britDisableBtn(t,e){t&&(t.classList.add("disabled"),t.setAttribute("aria-disabled","true"),t.setAttribute("tabindex","-1"),e&&t.setAttribute("title",e))}function getScope(){return(new URLSearchParams(window.location.search).get("scope")||"published").toLowerCase()}function getContextFlag(t){try{const e=document.getElementById("map-context");if(!e)return null;const n=e.dataset[t];return void 0===n?null:"true"===n||"false"!==n&&n}catch(t){return null}}function isStaffUser(){return!0===getContextFlag("isStaff")}function hideSelectionHint(){const t=document.getElementById("map-actions-hint");t&&t.classList.add("d-none")}function featureClickHandler(t,e){resetFeatureStyles(e);const n=new Set;e.eachLayer((e=>{if(e instanceof L.Polygon){const o=e.toGeoJSON(),a=[t.latlng.lng,t.latlng.lat];turf.inside(a,o)&&n.add(e)}}));let o="No features found",a="";n.size&&(o=[...n][0].feature.properties.catchment,a=[...n].map((t=>{const e=t.feature.properties.waste_category,n=t.feature.properties.collection_system;return selectFeature(t),`<a href="javascript:void(0)" onclick="getFeatureDetails(${t.feature.properties.id})">${e} - ${n}</a><br>`})).join("")),map.openPopup(`<strong>${o}</strong><br/>${a}`,t.latlng,{offset:L.point(0,-24)})}function createFeatureLayerBindings(t){t.bindTooltip((function(t){return t.feature.properties.catchment.toString()})),t.bindPopup((function(t){return t.feature.properties.catchment.toString()})),t.on("click",(e=>featureClickHandler(e,t)))}function scrollToSummaries(){const t=document.getElementById("filter_result_card");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function updateUrls(t){let e;try{e=parseFilterParameters()}catch(t){e=new URLSearchParams(window.location.search)}e.set("load_features","true");try{e.set("scope",getScope())}catch(t){}const n=window.location.pathname+"?"+e.toString(),o=new URLSearchParams;o.set("next",n);try{const t=document.getElementById("btn-collection-create"),e=t.dataset.hrefTemplate+"?"+o.toString();t.setAttribute("href",e)}catch(t){console.warn(`Create button not updated: ${t}`)}try{const e=document.getElementById("btn-collection-detail"),n=e.dataset.hrefTemplate.replace("__pk__",t.toString());e.setAttribute("href",n),e.classList.remove("d-none")}catch(t){console.warn(`Detail button not updated: ${t}`)}try{const e=document.getElementById("btn-collection-update"),n=e.dataset.hrefTemplate.replace("__pk__",t.toString())+"?"+o.toString();e.setAttribute("href",n)}catch(t){console.warn(`Update button not updated: ${t}`)}try{const e=document.getElementById("btn-collection-copy"),n=e.dataset.hrefTemplate.replace("__pk__",t.toString())+"?"+o.toString();e.setAttribute("href",n)}catch(t){console.warn(`Copy button not updated: ${t}`)}try{const e=document.getElementById("btn-collection-delete"),n=e.dataset.hrefTemplate.replace("__pk__",t.toString())+"?"+o.toString();modalForm(e,{formURL:n,errorClass:".is-invalid"})}catch(t){console.warn(`Delete button not updated: ${t}`)}try{britEnableBtn(document.getElementById("btn-collection-copy"))}catch(t){}hideSelectionHint()}function addDetailViewButton(){}function clickedPrivateMapButton(){const t=document.getElementById("link-map-private");window.location.href=t.dataset.hrefTemplate+"?"+parseFilterParameters().toString()}function clickedPublicMapButton(){const t=document.getElementById("link-map-public");console.log(t.dataset.hrefTemplate),window.location.href=t.dataset.hrefTemplate+"?"+parseFilterParameters().toString()}function clickedListButton(){const t=document.getElementById("btn-collections-as-list");window.location.href=t.dataset.hrefTemplate+"?"+parseFilterParameters().toString()}function clickedListLink(){const t=document.getElementById("link-collections-as-list");window.location.href=t.dataset.hrefTemplate+"?"+parseFilterParameters().toString()}function adaptMapConfig(){mapConfig.layerOrder=["features","region","catchment"]}!function(){const t="function"==typeof window.renderFeatureDetails?window.renderFeatureDetails:null;window.renderFeatureDetails=function(e){try{t&&t(e)}catch(t){console.warn("Original renderFeatureDetails failed:",t)}try{const t=String(e&&e.publication_status||"").toLowerCase(),n=getScope(),o=isStaffUser()||"private"===n&&"published"!==t,a=document.getElementById("btn-collection-update"),r=document.getElementById("btn-collection-delete");o?(britEnableBtn(a),britEnableBtn(r)):(britDisableBtn(a,"Select a permitted collection (private/review) or be staff"),britDisableBtn(r,"Select a permitted collection (private/review) or be staff"))}catch(t){console.warn("Failed to toggle Edit/Delete availability:",t)}}}();
function addSourceToList(e, t, n, o) { const a = document.createElement("li"); a.className = "list-group-item d-flex justify-content-between align-items-start", a.dataset.value = t; const c = document.createElement("div"); c.className = "source-title"; const l = document.createElement("a"); l.href = `/bibliography/sources/${t}/modal/`, l.className = "modal-link text-decoration-none", l.textContent = n, c.appendChild(l), window.wireModalLinks && window.wireModalLinks(); const s = document.createElement("button"); s.type = "button", s.className = "btn btn-sm btn-outline-danger source-remove-btn", s.dataset.value = t, s.setAttribute("aria-label", "Remove"), s.innerHTML = '<i class="fas fa-trash"></i>', a.appendChild(c), a.appendChild(s), e.appendChild(a) } document.addEventListener("DOMContentLoaded", (function () { document.querySelectorAll("input.source-tomselect-add").forEach((e => { if ("INPUT" !== e.tagName) return void console.warn("Expected input element but found:", e.tagName); const t = e.dataset.targetSelect, n = document.getElementById(t), o = document.getElementById(t + "_list"), a = document.getElementById(t + "_empty"), c = e.dataset.autocompleteUrl, l = e.dataset.labelField; e.tomselect && e.tomselect.destroy(); const s = new TomSelect(e, { valueField: "id", labelField: l, searchField: [l, "title"], placeholder: e.getAttribute("placeholder") || "Search sources...", maxOptions: 50, loadThrottle: 300, preload: "focus", create: !1, persist: !1, load: function (e, t) { const n = c + (e ? "?q=" + encodeURIComponent(e) : ""); fetch(n).then((e => e.json())).then((e => { t(e.results || e) })).catch((() => { t() })) }, onChange: function (e) { if (!e) return; const t = s.options[e]; if (!t) return; if (n.querySelector(`option[value="${e}"]`)) return void s.clear(); const c = document.createElement("option"); c.value = e, c.text = t[l], c.selected = !0, n.appendChild(c), addSourceToList(o, e, t[l], n), s.clear(), a && (a.style.display = "none") }, render: { option: function (e, t) { return '<div class="option">' + t(e[l]) + "</div>" }, item: function (e, t) { return "<div>" + t(e[l]) + "</div>" } }, placeholder: "Search sources...", plugins: ["clear_button"], closeAfterSelect: !0, hideSelected: !0 }); o.addEventListener("click", (function (e) { if (e.target.classList.contains("source-remove-btn") || e.target.closest(".source-remove-btn")) { const t = e.target.classList.contains("source-remove-btn") ? e.target : e.target.closest(".source-remove-btn"), c = t.dataset.value, l = n.querySelector(`option[value="${c}"]`); l && l.remove(); const s = t.closest("li"); s && s.remove(), 0 === o.children.length && a && (a.style.display = "block") } })); const r = n.closest("form"); r && r.addEventListener("submit", (function () { Array.from(n.options).forEach((e => { e.selected = !0 })) })) })) }));
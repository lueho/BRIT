function addSourceToList(e,t,n,o){const l=document.createElement("li");l.className="list-group-item d-flex justify-content-between align-items-start",l.dataset.value=t;const c=document.createElement("div");c.className="source-title",c.textContent=n;const s=document.createElement("button");s.type="button",s.className="btn btn-sm btn-outline-danger source-remove-btn",s.dataset.value=t,s.setAttribute("aria-label","Remove"),s.innerHTML='<i class="bi bi-x-lg"></i> Remove',l.appendChild(c),l.appendChild(s),e.appendChild(l)}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".source-tomselect-add").forEach((e=>{const t=e.dataset.targetSelect,n=document.getElementById(t),o=document.getElementById(t+"_list"),l=document.getElementById(t+"_empty"),c=e.dataset.autocompleteUrl,s=e.dataset.labelField;e.tomselect&&e.tomselect.destroy();const a=new TomSelect(e,{valueField:"id",labelField:s,searchField:[s,"title"],placeholder:e.getAttribute("placeholder")||"Search sources...",maxOptions:50,loadThrottle:300,preload:!1,create:!1,persist:!1,load:function(e,t){if(!e.length)return t();fetch(c+"?q="+encodeURIComponent(e)).then((e=>e.json())).then((e=>{t(e.results||e)})).catch((()=>{t()}))},onChange:function(e){if(!e)return;const t=a.options[e];if(!t)return;if(n.querySelector(`option[value="${e}"]`))return void a.clear();const c=document.createElement("option");c.value=e,c.text=t[s],c.selected=!0,n.appendChild(c),addSourceToList(o,e,t[s],n),a.clear(),l&&(l.style.display="none")},render:{option:function(e,t){return'<div class="option">'+t(e[s])+"</div>"},item:function(e,t){return"<div>"+t(e[s])+"</div>"}},placeholder:"Search sources...",plugins:["clear_button"],closeAfterSelect:!0,hideSelected:!0});o.addEventListener("click",(function(e){if(e.target.classList.contains("source-remove-btn")||e.target.closest(".source-remove-btn")){const t=e.target.classList.contains("source-remove-btn")?e.target:e.target.closest(".source-remove-btn"),c=t.dataset.value,s=n.querySelector(`option[value="${c}"]`);s&&s.remove();const a=t.closest("li");a&&a.remove(),0===o.children.length&&l&&(l.style.display="block")}}))}))}));
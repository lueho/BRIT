function addSourceToList(e,t,n,o){const a=e.dataset.detailUrlPattern.replace("/0/",`/${t}/`),l=document.createElement("li");l.className="list-group-item d-flex justify-content-between align-items-start",l.dataset.value=t;const c=document.createElement("div");c.className="source-title";const s=document.createElement("a");s.href=a,s.className="modal-link text-decoration-none",s.textContent=n,c.appendChild(s),window.wireModalLinks&&window.wireModalLinks();const r=document.createElement("button");r.type="button",r.className="btn btn-sm btn-outline-danger source-remove-btn",r.dataset.value=t,r.setAttribute("aria-label","Remove"),r.innerHTML='<i class="fas fa-trash"></i>',l.appendChild(c),l.appendChild(r),e.appendChild(l)}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("input.source-tomselect-add").forEach((function(e){if("INPUT"!==e.tagName)return void console.warn("Expected input element but found:",e.tagName);const t=e.dataset.targetSelect,n=document.getElementById(t),o=document.getElementById(t+"_list"),a=document.getElementById(t+"_empty"),l=e.dataset.autocompleteUrl,c=e.dataset.labelField;e.tomselect&&e.tomselect.destroy();const s=new TomSelect(e,{valueField:"id",labelField:c,searchField:[c,"title"],placeholder:e.getAttribute("placeholder")||"Search sources...",maxOptions:50,loadThrottle:300,preload:"focus",create:!1,persist:!1,load:function(e,t){const n=l+(e?"?q="+encodeURIComponent(e):"");fetch(n).then((e=>e.json())).then((e=>{t(e.results||e)})).catch((()=>{t()}))},onChange:function(e){if(!e)return;const t=s.options[e];if(!t)return;if(n.querySelector(`option[value="${e}"]`))return void s.clear();const l=document.createElement("option");l.value=e,l.text=t[c],l.selected=!0,n.appendChild(l),addSourceToList(o,e,t[c],n),s.clear(),a&&(a.style.display="none")},render:{option:function(e,t){return'<div class="option">'+t(e[c])+"</div>"},item:function(e,t){return"<div>"+t(e[c])+"</div>"}},placeholder:"Search sources...",plugins:["clear_button"],closeAfterSelect:!0,hideSelected:!0});o.addEventListener("click",(function(e){const t=e.target.classList.contains("source-remove-btn")?e.target:e.target.closest(".source-remove-btn");if(t){const e=t.dataset.value,l=n.querySelector(`option[value="${e}"]`);l&&l.remove();const c=t.closest("li");c&&c.remove(),0===o.children.length&&a&&(a.style.display="block")}}));const r=n.closest("form");r&&r.addEventListener("submit",(function(){Array.from(n.options).forEach((e=>{e.selected=!0}))}))}))}));
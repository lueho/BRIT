"use strict";void 0===window.resetVarName&&(window.resetVarName=function(e,t){if("string"==typeof e)return e.replace(/__prefix__/g,t);if("function"==typeof e){const o=e.toString().replace(/__prefix__/g,t);return new Function(`return (${o})`)()}return e});class TomSelectFormset{constructor(e){this.prefix=e.formPrefix,this.formId=e.formId||null;const t=this.formId?`${this.formId}_`:"";this.selContainer=e.containerSelector||`#${t}formset-container`,this.selEmpty=e.emptyFormSelector||`#${t}empty-form-row`,this.selAddBtn=e.addButtonSelector||`#${t}add-form`,this.container=document.querySelector(this.selContainer),this.empty=document.querySelector(this.selEmpty),this.btnAdd=document.querySelector(this.selAddBtn),this.total=document.querySelector(`#id_${this.prefix}-TOTAL_FORMS`),this.container&&this.empty&&this.btnAdd&&this.total&&this.init()}init(){const e=this.btnAdd.cloneNode(!0);this.btnAdd.replaceWith(e),this.btnAdd=e,this.btnAdd.addEventListener("click",(e=>this.addRow(e))),this.container.addEventListener("click",(e=>this.onRemove(e)))}addRow(e){e?.preventDefault();const t=Number(this.total.value),o=this.empty.cloneNode(!0);o.classList.remove("d-none"),o.removeAttribute("id"),this.replaceAll(o,"__prefix__",t),this.container.appendChild(o),this.total.value=t+1,this.initWidgets(o)}replaceAll(e,t,o){const r="string"==typeof t?new RegExp(t,"g"):t;Array.from(e.attributes||[]).forEach((t=>{const i=t.value.replace(r,o);i!==t.value&&e.setAttribute(t.name,i)})),e.nodeType===Node.ELEMENT_NODE&&"SCRIPT"===e.tagName&&r.test(e.textContent)&&(e.textContent=e.textContent.replace(r,o)),Array.from(e.childNodes).forEach((e=>this.replaceAll(e,r,o)))}initWidgets(e){if(e.querySelectorAll(".ts-wrapper").forEach((e=>e.remove())),window.djangoTomSelect?.reinitialize)try{window.djangoTomSelect.reinitialize(e)}catch(e){}else e.querySelectorAll("select[data-tomselect='true']").forEach((e=>{e.classList.remove("tomselected","ts-hidden-accessible"),e.tomselect&&e.tomselect.destroy(),window.djangoTomSelect?.initialize?window.djangoTomSelect.initialize(e):new TomSelect(e)}));document.dispatchEvent(new CustomEvent("formset:row:added",{bubbles:!0,detail:{row:e}}))}onRemove(e){const t=e.target.closest(".remove-form");if(!t)return;const o=t.closest(".formset-form-row");if(!o)return;const r=o.querySelector("input[name$='-DELETE']");r?(r.checked=!0,o.style.opacity=.5,o.style.pointerEvents="none"):(o.remove(),this.renumber())}renumber(){const e=this.container.querySelectorAll(".formset-form-row:not(.d-none)");this.total.value=e.length,e.forEach(((e,t)=>{e.querySelectorAll("[name]").forEach((e=>{e.name&&(e.name=e.name.replace(new RegExp(`${this.prefix}-\\d+`),`${this.prefix}-${t}`)),e.id&&(e.id=e.id.replace(new RegExp(`id_${this.prefix}-\\d+`),`id_${this.prefix}-${t}`))}))}))}}function initTomSelectFormset(e){return new TomSelectFormset(e)}window._tsFormsets||(window._tsFormsets=new Set),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("[data-tomselect-formset]").forEach((e=>{const t=e.dataset.tomselectFormset,o=e.dataset.tomselectFormsetId||"",r=`${t}-${o}`;window._tsFormsets.has(r)||(window._tsFormsets.add(r),initTomSelectFormset({formPrefix:t,formId:o||null}))}))})),window.initTomSelectFormset=initTomSelectFormset;